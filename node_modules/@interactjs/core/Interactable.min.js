import*as t from"../utils/arr.min.js";import e from"../utils/browser.min.js";import s from"../utils/clone.min.js";import{getElementRect as i,matchesUpTo as n,nodeContains as o,trySelector as r}from"../utils/domUtils.min.js";import c from"../utils/events.min.js";import h from"../utils/extend.min.js";import*as a from"../utils/is.min.js";import l from"../utils/normalizeListeners.min.js";import{getWindow as m}from"../utils/window.min.js";import u from"./Eventable.min.js";import{isNonNativeEvent as f}from"./scope.min.js";export class Interactable{get _defaults(){return{base:{},perAction:{},actions:{}}}constructor(t,e,s){this.options=void 0,this._actions=void 0,this.target=void 0,this.events=new u,this._context=void 0,this._win=void 0,this._doc=void 0,this._actions=e.actions,this.target=t,this._context=e.context||s,this._win=m(r(t)?this._context:t),this._doc=this._win.document,this.set(e)}setOnEvents(t,e){return a.func(e.onstart)&&this.on(`${t}start`,e.onstart),a.func(e.onmove)&&this.on(`${t}move`,e.onmove),a.func(e.onend)&&this.on(`${t}end`,e.onend),a.func(e.oninertiastart)&&this.on(`${t}inertiastart`,e.oninertiastart),this}updatePerActionListeners(t,e,s){(a.array(e)||a.object(e))&&this.off(t,e),(a.array(s)||a.object(s))&&this.on(t,s)}setPerAction(e,i){const n=this._defaults;for(const o in i){const r=o,c=this.options[e],l=i[r];"listeners"===r&&this.updatePerActionListeners(e,c.listeners,l),a.array(l)?c[r]=t.from(l):a.plainObject(l)?(c[r]=h(c[r]||{},s(l)),a.object(n.perAction[r])&&"enabled"in n.perAction[r]&&(c[r].enabled=!1!==l.enabled)):a.bool(l)&&a.object(n.perAction[r])?c[r].enabled=l:c[r]=l}}getRect(t){return t=t||(a.element(this.target)?this.target:null),a.string(this.target)&&(t=t||this._context.querySelector(this.target)),i(t)}rectChecker(t){return a.func(t)?(this.getRect=t,this):null===t?(delete this.getRect,this):this.getRect}_backCompatOption(t,e){if(r(e)||a.object(e)){this.options[t]=e;for(const s in this._actions.map)this.options[s][t]=e;return this}return this.options[t]}origin(t){return this._backCompatOption("origin",t)}deltaSource(t){return"page"===t||"client"===t?(this.options.deltaSource=t,this):this.options.deltaSource}context(){return this._context}inContext(t){return this._context===t.ownerDocument||o(this._context,t)}testIgnoreAllow(t,e,s){return!this.testIgnore(t.ignoreFrom,e,s)&&this.testAllow(t.allowFrom,e,s)}testAllow(t,e,s){return!t||!!a.element(s)&&(a.string(t)?n(s,t,e):!!a.element(t)&&o(t,s))}testIgnore(t,e,s){return!(!t||!a.element(s))&&(a.string(t)?n(s,t,e):!!a.element(t)&&o(t,s))}fire(t){return this.events.fire(t),this}_onOff(t,s,i,n){a.object(s)&&!a.array(s)&&(n=i,i=null);const o="on"===t?"add":"remove",r=l(s,i);for(let s in r){"wheel"===s&&(s=e.wheelEvent);for(const e of r[s])f(s,this._actions)?this.events[t](s,e):a.string(this.target)?c[`${o}Delegate`](this.target,this._context,s,e,n):c[o](this.target,s,e,n)}return this}on(t,e,s){return this._onOff("on",t,e,s)}off(t,e,s){return this._onOff("off",t,e,s)}set(t){const e=this._defaults;a.object(t)||(t={}),this.options=s(e.base);for(const s in this._actions.methodDict){const i=s,n=this._actions.methodDict[i];this.options[i]={},this.setPerAction(i,h(h({},e.perAction),e.actions[i])),this[n](t[i])}for(const e in t)a.func(this[e])&&this[e](t[e]);return this}unset(){if(c.remove(this.target,"all"),a.string(this.target))for(const t in c.delegatedEvents){const e=c.delegatedEvents[t];e.selectors[0]===this.target&&e.contexts[0]===this._context&&(e.selectors.splice(0,1),e.contexts.splice(0,1),e.listeners.splice(0,1)),c.remove(this._context,t,c.delegateListener),c.remove(this._context,t,c.delegateUseCapture,!0)}else c.remove(this.target,"all")}}export default Interactable;
//# sourceMappingURL=Interactable.min.js.map